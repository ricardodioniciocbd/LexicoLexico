.model small\n.stack 100h\n\n.data\n; -----------------------\n; Constantes\n; -----------------------\nID_LEN      EQU 5       ; máximo 5 caracteres para ID\nNAME_LEN    EQU 20      ; máximo 20 caracteres para nombre\nEDAD_LEN    EQU 3       ; máximo 3 caracteres para edad\nCARR_LEN    EQU 20      ; máximo 20 caracteres para carrera\nPROM_LEN    EQU 3       ; máximo 3 caracteres para promedio\n\n; ----- Mensajes -----\nmsg_menu_title     DB 0Dh,0Ah,'===== MENU DE ESTUDIANTES =====',0Dh,0Ah,'$'\nmsg_menu_1         DB '1. Alta (Agregar)',0Dh,0Ah,'$'\nmsg_menu_2         DB '2. Baja (Eliminar)',0Dh,0Ah,'$'\nmsg_menu_3         DB '3. Modificar',0Dh,0Ah,'$'\nmsg_menu_4         DB '4. Listar',0Dh,0Ah,'$'\nmsg_menu_5         DB '5. Salir',0Dh,0Ah,'$'\nmsg_menu_opt       DB 'Seleccione una opcion: ','$'\n\nmsg_pide_id        DB 0Dh,0Ah,'Ingrese ID: ','$'\nmsg_pide_nombre    DB 0Dh,0Ah,'Ingrese nombre: ','$'\nmsg_pide_edad      DB 0Dh,0Ah,'Ingrese edad: ','$'\nmsg_pide_carrera   DB 0Dh,0Ah,'Ingrese carrera: ','$'\nmsg_pide_prom      DB 0Dh,0Ah,'Ingrese promedio: ','$'\n\nmsg_pide_id_baja   DB 0Dh,0Ah,'Ingrese ID a eliminar: ','$'\nmsg_pide_id_mod    DB 0Dh,0Ah,'Ingrese ID a modificar: ','$'\n\nmsg_pide_nuevo_nom DB 0Dh,0Ah,'Nuevo nombre: ','$'\nmsg_pide_nueva_edad DB 0Dh,0Ah,'Nueva edad: ','$'\nmsg_pide_nueva_carr DB 0Dh,0Ah,'Nueva carrera: ','$'\nmsg_pide_nuevo_prom DB 0Dh,0Ah,'Nuevo promedio: ','$'\n\nmsg_ok             DB 0Dh,0Ah,'Operacion realizada correctamente.',0Dh,0Ah,'$'\nmsg_no_reg         DB 0Dh,0Ah,'No hay estudiante registrado.',0Dh,0Ah,'$'\nmsg_no_encontrado  DB 0Dh,0Ah,'ID no encontrado.',0Dh,0Ah,'$'\nmsg_invalid_opt    DB 0Dh,0Ah,'Opcion no valida.',0Dh,0Ah,'$'\n\nmsg_lista_title    DB 0Dh,0Ah,'Lista de estudiante:',0Dh,0Ah,'$'\nmsg_vacio          DB '(vacio)',0Dh,0Ah,'$'\n\nmsg_id_label       DB 'ID: ','$'\nmsg_sep_nombre     DB ' - Nombre: ','$'\nmsg_sep_edad       DB ' - Edad: ','$'\nmsg_sep_carrera    DB ' - Carrera: ','$'\nmsg_sep_prom       DB ' - Promedio: ','$'\n\n; ----- Almacenamiento del registro -----\nid_str     DB ID_LEN+1 DUP('$')       ; ID almacenado\nname_str   DB NAME_LEN+1 DUP('$')     ; Nombre almacenado\nedad_str   DB EDAD_LEN+1 DUP('$')     ; Edad almacenada\ncarr_str   DB CARR_LEN+1 DUP('$')     ; Carrera almacenada\nprom_str   DB PROM_LEN+1 DUP('$')     ; Promedio almacenado\n\ntemp_str   DB ID_LEN+1 DUP('$')       ; buffer temporal para comparar IDs\nreg_flag   DB 0                       ; 0 = no hay registro, 1 = hay registro\n\n; ----- Buffers de entrada para INT 21h / 0Ah -----\n; [0]=max chars, [1]=longitud leida, [2..]=datos\nopt_buf    DB 2,0,2 DUP(?)                     ; opcion del menu (1 caracter)\n\nid_buf     DB ID_LEN,0,ID_LEN+1 DUP(?)         ; buffer para ID\nname_buf   DB NAME_LEN,0,NAME_LEN+1 DUP(?)     ; buffer para nombre\nedad_buf   DB EDAD_LEN,0,EDAD_LEN+1 DUP(?)     ; buffer para edad\ncarr_buf   DB CARR_LEN,0,CARR_LEN+1 DUP(?)     ; buffer para carrera\nprom_buf   DB PROM_LEN,0,PROM_LEN+1 DUP(?)     ; buffer para promedio\n\n\n.code\n\nstart:\n    mov ax, @data\n    mov ds, ax\n\n; ==========================\n;   BUCLE PRINCIPAL\n; ==========================\nmain_loop:\n    ; Mostrar menú\n    mov dx, OFFSET msg_menu_title\n    call print_str\n    mov dx, OFFSET msg_menu_1\n    call print_str\n    mov dx, OFFSET msg_menu_2\n    call print_str\n    mov dx, OFFSET msg_menu_3\n    call print_str\n    mov dx, OFFSET msg_menu_4\n    call print_str\n    mov dx, OFFSET msg_menu_5\n    call print_str\n    mov dx, OFFSET msg_menu_opt\n    call print_str\n\n    ; Leer opción\n    mov dx, OFFSET opt_buf\n    mov ah, 0Ah\n    int 21h\n    call newline          ; salto de linea\n\n    mov al, [opt_buf+2]   ; primer caracter de la opcion\n\n    cmp al, '1'\n    je  do_alta\n    cmp al, '2'\n    je  do_baja\n    cmp al, '3'\n    je  do_modificar\n    cmp al, '4'\n    je  do_listar\n    cmp al, '5'\n    je  salir\n\n    ; opcion invalida\n    mov dx, OFFSET msg_invalid_opt\n    call print_str\n    jmp main_loop\n\n; -------------------------\n; Alta\n; -------------------------\ndo_alta:\n    ; Pedir ID\n    mov dx, OFFSET msg_pide_id\n    call print_str\n    mov dx, OFFSET id_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    ; buffer -> id_str\n    mov si, OFFSET id_buf\n    mov di, OFFSET id_str\n    call buffer_to_dos\n\n    ; Pedir nombre\n    mov dx, OFFSET msg_pide_nombre\n    call print_str\n    mov dx, OFFSET name_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    ; buffer -> name_str\n    mov si, OFFSET name_buf\n    mov di, OFFSET name_str\n    call buffer_to_dos\n\n    ; Pedir edad\n    mov dx, OFFSET msg_pide_edad\n    call print_str\n    mov dx, OFFSET edad_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET edad_buf\n    mov di, OFFSET edad_str\n    call buffer_to_dos\n\n    ; Pedir carrera\n    mov dx, OFFSET msg_pide_carrera\n    call print_str\n    mov dx, OFFSET carr_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET carr_buf\n    mov di, OFFSET carr_str\n    call buffer_to_dos\n\n    ; Pedir promedio\n    mov dx, OFFSET msg_pide_prom\n    call print_str\n    mov dx, OFFSET prom_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET prom_buf\n    mov di, OFFSET prom_str\n    call buffer_to_dos\n\n    ; marcar registro como ocupado\n    mov reg_flag, 1\n\n    mov dx, OFFSET msg_ok\n    call print_str\n    call newline\n    jmp main_loop\n\n; -------------------------\n; Baja\n; -------------------------\ndo_baja:\n    cmp reg_flag, 1\n    jne no_registro_baja\n\n    ; Pedir ID a eliminar\n    mov dx, OFFSET msg_pide_id_baja\n    call print_str\n    mov dx, OFFSET id_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    ; entrada -> temp_str\n    mov si, OFFSET id_buf\n    mov di, OFFSET temp_str\n    call buffer_to_dos\n\n    ; comparar id_str (almacenado) con temp_str (entrada)\n    mov si, OFFSET id_str\n    mov di, OFFSET temp_str\n    call cmp_strings         ; AL = 1 si iguales\n\n    cmp al, 1\n    jne not_found_baja\n\n    ; Coinciden: eliminar registro\n    mov reg_flag, 0\n\n    ; limpiar id_str\n    mov cx, ID_LEN+1\n    mov di, OFFSET id_str\nfill_id:\n    mov byte ptr [di], '$'\n    inc di\n    loop fill_id\n\n    ; limpiar name_str\n    mov cx, NAME_LEN+1\n    mov di, OFFSET name_str\nfill_name:\n    mov byte ptr [di], '$'\n    inc di\n    loop fill_name\n\n    ; limpiar edad_str\n    mov cx, EDAD_LEN+1\n    mov di, OFFSET edad_str\nfill_edad:\n    mov byte ptr [di], '$'\n    inc di\n    loop fill_edad\n\n    ; limpiar carr_str\n    mov cx, CARR_LEN+1\n    mov di, OFFSET carr_str\nfill_carr:\n    mov byte ptr [di], '$'\n    inc di\n    loop fill_carr\n\n    ; limpiar prom_str\n    mov cx, PROM_LEN+1\n    mov di, OFFSET prom_str\nfill_prom:\n    mov byte ptr [di], '$'\n    inc di\n    loop fill_prom\n\n    mov dx, OFFSET msg_ok\n    call print_str\n    call newline\n    jmp main_loop\n\nno_registro_baja:\n    mov dx, OFFSET msg_no_reg\n    call print_str\n    jmp main_loop\n\nnot_found_baja:\n    mov dx, OFFSET msg_no_encontrado\n    call print_str\n    jmp main_loop\n\n; -------------------------\n; Modificar (cambiar todos los datos)\n; -------------------------\ndo_modificar:\n    cmp reg_flag, 1\n    jne no_registro_mod\n\n    ; Pedir ID a modificar\n    mov dx, OFFSET msg_pide_id_mod\n    call print_str\n    mov dx, OFFSET id_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    ; entrada -> temp_str\n    mov si, OFFSET id_buf\n    mov di, OFFSET temp_str\n    call buffer_to_dos\n\n    ; comparar con id_str almacenado\n    mov si, OFFSET id_str\n    mov di, OFFSET temp_str\n    call cmp_strings\n    cmp al, 1\n    jne not_found_mod\n\n    ; Coincide: pedir nuevos datos\n\n    ; nuevo nombre\n    mov dx, OFFSET msg_pide_nuevo_nom\n    call print_str\n    mov dx, OFFSET name_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET name_buf\n    mov di, OFFSET name_str\n    call buffer_to_dos\n\n    ; nueva edad\n    mov dx, OFFSET msg_pide_nueva_edad\n    call print_str\n    mov dx, OFFSET edad_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET edad_buf\n    mov di, OFFSET edad_str\n    call buffer_to_dos\n\n    ; nueva carrera\n    mov dx, OFFSET msg_pide_nueva_carr\n    call print_str\n    mov dx, OFFSET carr_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET carr_buf\n    mov di, OFFSET carr_str\n    call buffer_to_dos\n\n    ; nuevo promedio\n    mov dx, OFFSET msg_pide_nuevo_prom\n    call print_str\n    mov dx, OFFSET prom_buf\n    mov ah, 0Ah\n    int 21h\n    call newline\n\n    mov si, OFFSET prom_buf\n    mov di, OFFSET prom_str\n    call buffer_to_dos\n\n    mov dx, OFFSET msg_ok\n    call print_str\n    call newline\n    jmp main_loop\n\nno_registro_mod:\n    mov dx, OFFSET msg_no_reg\n    call print_str\n    jmp main_loop\n\nnot_found_mod:\n    mov dx, OFFSET msg_no_encontrado\n    call print_str\n    jmp main_loop\n\n; -------------------------\n; Listar\n; -------------------------\ndo_listar:\n    mov dx, OFFSET msg_lista_title\n    call print_str\n\n    cmp reg_flag, 1\n    jne listar_vacio\n\n    ; Imprimir: ID: <id> - Nombre: <nombre> - Edad: <edad> - Carrera: <carr> - Promedio: <prom>\n\n    mov dx, OFFSET msg_id_label\n    call print_str\n    mov dx, OFFSET id_str\n    call print_str\n\n    mov dx, OFFSET msg_sep_nombre\n    call print_str\n    mov dx, OFFSET name_str\n    call print_str\n\n    mov dx, OFFSET msg_sep_edad\n    call print_str\n    mov dx, OFFSET edad_str\n    call print_str\n\n    mov dx, OFFSET msg_sep_carrera\n    call print_str\n    mov dx, OFFSET carr_str\n    call print_str\n\n    mov dx, OFFSET msg_sep_prom\n    call print_str\n    mov dx, OFFSET prom_str\n    call print_str\n\n    call newline\n    jmp main_loop\n\nlistar_vacio:\n    mov dx, OFFSET msg_vacio\n    call print_str\n    jmp main_loop\n\n; -------------------------\n; Salir\n; -------------------------\nsalir:\n    mov ax, 4C00h\n    int 21h\n\n; ====================================================\n; Subrutinas\n; ====================================================\n\n; Imprime cadena terminada en '$' (DX = offset)\nprint_str PROC\n    push ax\n    mov ah, 09h\n    int 21h\n    pop ax\n    ret\nprint_str ENDP\n\n; Imprime salto de línea (CR/LF)\nnewline PROC\n    push ax\n    push dx\n    mov ah, 02h\n    mov dl, 0Dh\n    int 21h\n    mov dl, 0Ah\n    int 21h\n    pop dx\n    pop ax\n    ret\nnewline ENDP\n\n; Convierte buffer de INT 21h / 0Ah a cadena terminada en '$'\n; ENTRADA: SI = dir del buffer (0Ah)\n;          DI = destino\nbuffer_to_dos PROC\n    push ax\n    push cx\n\n    mov cl, [si+1]     ; longitud leida\n    mov ch, 0\n    add si, 2          ; SI -> primer caracter\n\ncopy_loop_bt:\n    cmp cx, 0\n    je  end_copy_bt\n    mov al, [si]\n    mov [di], al\n    inc si\n    inc di\n    dec cx\n    jmp copy_loop_bt\n\nend_copy_bt:\n    mov al, '$'\n    mov [di], al\n\n    pop cx\n    pop ax\n    ret\nbuffer_to_dos ENDP\n\n; Compara dos cadenas terminadas en '$'\n; ENTRADA: SI = str1, DI = str2\n; SALIDA : AL = 1 si son iguales, 0 si no\ncmp_strings PROC\n    push bx\n\ncmp_loop:\n    mov al, [si]\n    mov bl, [di]\n    cmp al, bl\n    jne not_equal_cs\n    cmp al, '$'\n    je  equal_cs\n    inc si\n    inc di\n    jmp cmp_loop\n\nequal_cs:\n    mov al, 1\n    jmp end_cs\n\nnot_equal_cs:\n    mov al, 0\n\nend_cs:\n    pop bx\n    ret\ncmp_strings ENDP\nEND start